/*
            
  â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’                                                â–’â–“â–ˆâ–ˆâ–“â–’
  â–’â–“â–ˆâ–ˆâ–“â–’                                                       â–’â–“â–ˆâ–ˆâ–“â–’
  â–’â–“â–ˆâ–ˆâ–“â–’                                                       â–’â–“â–ˆâ–ˆâ–“â–’â–’â–“â–ˆâ–ˆâ–“â–’
  â–’â–“â–ˆâ–ˆâ–“â–’        â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’   â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–“â–ˆâ–ˆâ–“â–’   â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’
  â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–“â–’  â–“â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–“â–’     â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–“â–’â–’â–“â–ˆâ–ˆâ–“â–’
  â–’â–“â–ˆâ–ˆâ–“â–’      â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–“â–’        â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’â–’â–“â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–“â–ˆâ–ˆâ–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’â–’â–“â–ˆâ–ˆâ–“â–’
  â–’â–“â–ˆâ–ˆâ–“â–’      â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–“â–’            â–’â–“â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’â–’â–“â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–ˆâ–“â–’     â–’â–“â–ˆâ–ˆâ–“â–’â–’â–“â–ˆâ–ˆâ–“â–’
  â–’â–“â–ˆâ–ˆâ–“â–’        â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’      â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’   â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–“â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆâ–“â–’â–’â–“â–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–’ â–’â–“â–ˆâ–ˆâ–“â–’â–’â–“â–ˆâ–ˆâ–“â–’


  ð’ðžð§ð­ð¥ðž (ð—ð‘) - ð…ð¨ð«ð¬ðšð¤ðžð§.
  ð€ð§ ðžð§ð­ð«ð² ðŸð¨ð« ðð²ð­ðžððšð­ð­ð¥ðž ð’ðžðšð¬ð¨ð§ ð•ðˆ.
  ð˜ð¨ð® ðœðšð§ ð«ðžð¦ð¢ð± ð¢ð­ ð¢ðŸ ð²ð¨ð® ð°ðšð§ð­ ð­ð¨.
  ð.ð’. ...ð°ð¡ð¨ ð¬ð­ð¨ð¥ðž ð­ð¡ðž ð§ð®ð¦ð›ðžð«ð¬?
*/

// t||() statement. Contains "constant" variables and filters, most of them originally from Feeshbread. Do NOT remove this statement, otherwise everything will be VERY slow.
t||(

// "Numbers"
z=t-t,
on=cos(z),
tw=on+on,
tri=tw+on,
fr=tw+tw,
ei=fr+fr,
sx=ei+ei,
si=tri*tw,
twlv=si*tw,
tV=sx*tw,
tVI=tV*tw,
tVII=tVI*tw,
sv=si+on,
tVIII=tVII*tw,
tIX=tVIII*tw,
tX=tIX*tw,
tXI=tX*tw,
tXII=tXI*tw,
tXIII=tXII*tw,
tXIV=tXII*fr,
tXV=tXIV*tw,
tXVI=tXV*tw,
tXVIII=tXVI*fr,
rIs=tXIII+tX+tIX+tVIII+tV+sx+fr+tw,
rIIs=tXIII+tXII+tIX+tVIII+tVII+tVI+tV,
rIIIs=tXIII+tXI+tX+tIX+tVIII,
rIVs=tXIV+tXII+tX+tIX+tVII+sx,
rIIv=tVIII+tV,
rIIIv=tVIII+tVI,
rIVv=tVIII+tVII,
tn=ei+tw,
Mx=tn**si,
N=sx+ei,
Gn=tV+sx,
Sk=tn+Gn,
oF=Gn*tw,
yI=twlv+tw,
yII=yI+on,
yIV=yII+tw,
yV=yIV+on,
yVII=yV+tw,
eT=tV+on,
ri=eT-tri,
rii=ri+on,
riii=rii+tri,
riv=tVI-on,
rv=oF-ei,
rvi=oF-tw,
rvii=oF+tw,
rviii=rvii+si,
rix=rviii+ei,
rx=tVII+sx,
qI=tVII-tw,
qII=tVII+tw,
quI=tVII+Gn,
qIII=quI-tw,
qIV=quI+tw,
qV=tVI+tVII,
ni=yVII*tn,
nii=ni+ei,
niii=nii-tw,
niv=nii+tw,
ui=N*tn,
uii=ui-on,
uiii=tVIII+sx,
uiv=uiii-tw,
uv=uiii+tw,
uvi=tVIII+tV,
uvii=uv-tn,
bi=ri*tn+fr,
bii=bi-tw,
biii=bi+tw,
biv=biii+si,
bv=bii-si,
ci=biv+sx,
cii=ci+sx,
ciii=N*yII,
civ=ciii+ei,
cv=civ+ei,
di=rIVv-tw,
dii=rIVv+tw,
diii=dii+sx+ei+fr,
div=diii+on,
dv=div+on,
dvi=dv+tw,
dvii=dvi+ri,
dviii=dvii-tw,
dix=dvii+tw,
dx=dix+tw,
dxi=dx+on,
svn=sv*tn,
hlf=on/(on+on),
oah=on+hlf,
kl=hlf/(N*tw+tw),
klv=kl*tn,
SdkA=(cv-on)/tw,
SdkB=N+tri+hlf,
ssKi=on+kl,
ssKii=on-((kl*yII)/tn),
ssKiii=on+(kl/tw),
bui=kl*(tri+tw),
buii=bui/tw,
qurt=hlf/tw,
onaqr=on+qurt,
thrfr=tri*qurt,
vni=tri*klv,
vnii=fr*klv,
vniii=tw*klv,
vniv=si*klv,
vnv=(tn-on)*klv,
hni=onaqr-klv,
hnii=hni+bui,
hnk=on+(tV/(tn*tn)),
hniii=onaqr+hlf,
hniv=tw+hlf,
hnv=hniv+on,
drI=on-(tri/(tn**fr)),
drII=on-oah*tn**(-fr),
drIII=on-onaqr*tn**(-fr),
RfbI=oah/tn,
RfbII=vni+bui,
RfbIII=vnii+bui,
RfbIV=vniv+bui,
KBPM=((svn+tri+tw)**tw)/tVI,
BPM=qI+ei,

// Sequences
_Aa='W',
_Ab='WZ\\^',
_Ac='NPRU',
_Ad='RRUUNNPP',
_Ae='RU',
_Ba='^',
_Bb='^ace',
_Bc='UWY\\',
_Bd='YY\\\\ZZWW',
_Be='Y\\',
_Ca='f',
_Cb='fjlm',
_Cc='^`ae',
_Cd='aaee^^\\\\',
_Ce='ae',
_Da='o',
_Db='ortv',
_Dc='fhjm',
_Dd='jjmmjj``',
_De='jm',
_Ea='v',
_Eb='vy{}',
_Ec='moqt',
_Ed='qqtvqqto',
_Ee='qt',
_Ra='^UZ^a^\\^c`^\\ecehjlmjhjmhfc`\\^acefhjmljhjhfcfjlmoqtvtqomomjhfehjm',
_Rb='RZfZh\\c\\j^a^mjhe',
_Rc='qjqtqtvytmtmvmvyqjqvqvyvthtxxovr',
_Rd='WcZf\\h^j',
_Re='Z\\^a',
_Rf='^aZ\\',
_Rg='WZ\\^',
_Rh='fjmororomortyvtrtolhlotx}vqmjea^',
_Ri=' cehjhcahjmoqtvy',
_Rj='j',
_Rk='NUZ^a^ZUW\\`chc`\\^aehjhecacehmhec',

// Buffers
Bf=[],
Ba=[],
Br=[],

// Filters
lp=(x,i)=>(c=Cn++,Bf[c]??=z,Bf[c]+=(x-Bf[c])*i),
lpR=(x,i,r)=>(c=Cn++,Bf[c]??=Ba[c]??=z,Bf[c]+=Ba[c]+=(x-Bf[c]-Ba[c]*r)*i),

hp=(x,i)=>x-lp(x,i),
hpR=(x,i,r)=>(c=Cn++,Bf[c]??=Ba[c]??=z,Bf[c]+=Ba[c]+=(x-Bf[c]-Ba[c]*r)*i,x-Bf[c]),

bp=(x,i,j)=>hp(lp(x,j),i),

nf=(x,i,j)=>lp(x,j)+hp(x,i),

// Portamento
I=(x,i)=>(c=Cn++,Bf[c]??=Ba[c]??=z,Bf[c]+=Ba[c]+=(x-Ba[c])/i),

// Reverb
R=(i,H,d,w,fb=x=>x)=>{c=Cn++;Br[c]??=Array(Mx).fill(z);o=z;f=i;for(h of H){cc=(Mx+dt-round(h.t))%Mx;f+=Br[c][cc]*h.fb;o+=Br[c][cc]*h.m};Br[c][dt%Mx]=fb(f);return i*d+o*w},

// Sequence function
sC=x=>x.charCodeAt()-Sk,
seq=(x,y=z)=>sC(x)<z?z:tw**((sC(x)+si+y-Gn)/twlv)/(SdkA/(SdkB*tw**(eT/twlv))),

// Sawtooth wave with detune unison
SSUni=(x,f,i)=>(((I(x/sx*(i?ssKi:on),f)%sx+I(x/sx*ssKi*(i?ssKi:on),f)%sx+I(x/sx*ssKii*(i?ssKi:on),f)%sx+I(x/sx*ssKiii*(i?ssKi:on),f)%sx)+oF)/tVII%tw-on)*tri,
SS=(x,y)=>SSUni(x,tXII,y),

// Square wave with detune unison
SQUni=(x,f,i)=>((((I(x/ei*(i?ssKi:on),f)&sx)+(I(x/ei*ssKi*(i?ssKi:on),f)&sx)+(I(x/ei*ssKii*(i?ssKi:on),f)&sx)+(I(x/ei*ssKiii*(i?ssKi:on),f)&sx))+oF)/tVII%tw-on)*oah,
SQ=(x,y)=>SQUni(x,tXI,y),

// Sawtooth wave
ss=(x,p,s)=>((s?tVI:z)+I(x,p))/tVII%tw-on,

// Pluck
Pl=(x,y,i,n)=>atan(bp(lp(((n?tVI:z)+I(x,i))/tVII%tw-on,y),kl,klv)*PI),

// Bleep
Bl=(x,a,b,s)=>((s?tVI:z)+I(x*tw**(T/a&b),on))/tVII%tw-on,
BlR=(x,a,b,s)=>((s?tVI:z)+I(x,on)>>(b&T/a))/tVII%tw-on,

// PWM wave
Pwm=(x,p,i,y)=>((y?tVI:z)+I(x,i)%tVIII>p?z:on)+((y?tVI:z)+I(x/tw,i)%tVIII>p?z:on)-on,

// Define BPM
Bpm=BPM

),

Cn=z,

dt=t,

// Set of comb-filters with their detune
rH=[
	{t:rIs+sin(t*PI/tVII/tVIII)*tVII,m:hlf,fb:RfbI}, 
	{t:rIIs+sin(t*PI/tVII/rIIv)*tVII,m:hlf,fb:RfbII}, 
	{t:rIIIs+sin(t*PI/tVII/rIIIv)*tVII,m:klv,fb:RfbIII}, 
	{t:rIVs+sin(t*PI/tVII/rIVv)*tVII,m:klv,fb:RfbIV}
],

// Noise
rL=random()*tw-on,
rR=random()*tw-on,

// Time variable with BPM
T=t/KBPM*Bpm,
u=T/tXVI,

// Transpose
tr=tw+(u>=dv?tw:z),


kZ=tanh((T/tVII/tVIII%on)*PI/tw),
Sw=asin(sin(tri*PI/tw+T*PI/tVII/tVI))/PI+hlf,


// Stereo mix
Ch=x=>(

bp(lp((
(SS(seq(

u>=dvii?_Aa:u>=biv?_Ab[(T>>yIV)%fr]:u>=tVII?_Ac[(T>>yIV)%fr]:u>=tV?_Ad[(T>>yIV)%ei]:_Ae[(T>>yVII)%tw]


,tr),x)+SS(seq(

u>=dvii?_Ba:u>=biv?_Bb[(T>>yIV)%fr]:u>=tVII?_Bc[(T>>yIV)%fr]:u>=tV?_Bd[(T>>yIV)%ei]:_Be[(T>>yVII)%tw]


,tr),x)+SS(seq(

u>=dvii?_Ca:u>=biv?_Cb[(T>>yIV)%fr]:u>=tVII?_Cc[(T>>yIV)%fr]:u>=tV?_Cd[(T>>yIV)%ei]:_Ce[(T>>yVII)%tw]


,tr),x)+SS(seq(

u>=dvii?_Da:u>=biv?_Db[(T>>yIV)%fr]:u>=tVII?_Dc[(T>>yIV)%fr]:u>=tV?_Dd[(T>>yIV)%ei]:_De[(T>>yVII)%tw]


,tr),x)+SS(seq(

u>=dvii?_Ea:u>=biv?_Eb[(T>>yIV)%fr]:u>=tVII?_Ec[(T>>yIV)%fr]:u>=tV?_Ed[(T>>yIV)%ei]:_Ee[(T>>yVII)%tw]


,tr),x))*(u>=biv?hlf:on)

+SQ(
seq(

_Ed[(T>>yIV)%ei]

,tr)*tw,x)*(u>=bi?z:u>=tV?on:z)

+

SQ(seq(u>=dvii?_Da:u>=rIVv?_Ra[(T>>yII)%tVI]:u>=rx?_Rb[(T>>yII)%sx]:_Rc[(T>>yII)%tV],tr)*fr,x)*(u>=rIVv?tw:u>=bi?z:u>=qV?tw:u>=rx?tri:u>=oF?z:u>=tVI?on:z)
+
SQ(seq(_Rb[(T>>yII)%sx],tr+sv)*fr,x)*(u>=bi?z:u>=qV?tw:z)
)*oah,u>=cv?on:u>=biv?klv:u>=quI?on:u>=tVII?klv:u>=tV?on:klv),buii,u>=tV?on:bui)*tri*(u>=cv?onaqr:u>=biv?asin(sin(tri*PI/tw+T*PI/tVII/tIX))/PI*tw+on:u>=bi?z:u>=tVII?thrfr:u>=oF?z:u>=tV?on:min(asin(sin(tri*PI/tw+T*PI/tVII/tXII))/PI*tw+on,on))
+
nf(SS(seq(u>=ciii?_Rd[(T>>sx)%ei]:u>=rix?_Re[(T>>yIV)%fr]:_Rf[(T>>yV)%fr],tr),x)*(u>=dvii?z:u>=ciii?hnv:u>=bi?z:u>=oF?on:z),bui,vni)*tw
+
lp(nf(Pwm((u>=ci?seq(_Rg[(T>>yIV)%fr],tr)*((T>>yI&on)+on):seq(_Re[(T>>yIV)%fr],tr))*(u>=cii?tw:on),sin(T*PI/tVII/tIX)*tVI+tVII,tX,x),qurt,klv),hlf)*tw*(u>=dvii?z:u>=ci?oah:u>=bi?z:u>=tVII?on:z)
+
sin((sin(ss(seq(_Rh[(T>>yI)%tV],tr),on,x)*PI)+sin(ss(seq(_Rh[(T>>yI)%tV],tr),on,x)*PI*sx)*(T/tVII/tVII%on-on)/tw)*tw)*(T/tVII/tVII%on-oah)*oah*(u>=dvii?z:u>=cii?on:z)
)/fr,


Mix=x=>
(
lp(
hp(R(
Ch(x)*(u>=dx?z:on)
+
lp((sqrt(T%(tXIV/tw**(T>>yIV&tri))/fr)*tIX*(oah**(T>>yIV&tri)))/tVII%tw-on,hlf)/onaqr*(u>=rIVv?z:u>=cv?on:u>=bi?z:u>=bv?on:u>=uiii?z:u>=uvii?on:u>=nii?z:u>=ni?on:u>=oF?z:u>=rv?on:z)
,rH,u>=biv?on:u>=tVII?thrfr:u>=rviii?z:u>=tV?on:hlf,on,x=>hp(x,kl))*(u>=oF?on:u>=tV?oah:u>=rii?z:on),buii)
+
Pl(seq(_Ri[(T>>yIV)%sx],tr),((-T/tVIII/tIX%on)+on)/ei+buii,tXII,x)/ei*(u>=rii?z:on)
+
lp(lpR(x?rR:rL,vniii,tri),klv)*(-min(asin(sin(tri*PI/tw+T*PI/tVII/tXII))/PI*tw+on,on)+on)/tw*(u>=yVII?z:u>=fr?on:z)
+
R(
(lp(Bl(seq(u>=dx?_Da:_Rj,tr),tXII,tri,x),hlf))*(u>=dx?tri:on)*(-((T>>yI&tri)&&on)+on)*(u>=dxi?z:u>=dx?on:u>=tV?z:u>=rii?on:z)
+
cbrt(sin(BlR(seq(_Rk[(T>>yI)%tV],tr)*sx,tXI,sv,on)*PI))*(u>=bi?z:u>=ui?on:z)

,rH,u>=ui?oah:on,on,x=>hp(x,kl))*(u>=ui?on:u>=tV?z:u>=rii?on:z)/tw
,
u>=dv?on:u>=div?Sw:u>=uvi?on:u>=uiii?cos(T*PI/tVII/tXII)**tw/tw+klv:u>=ui?on:u>=uii?Sw:u>=tVI?on:u>=riv?Sw:on
)*(u>=dvii?on:u>=civ?kZ:u>=bi?on:u>=uvi?kZ:u>=uiii?on:u>=ni?kZ:u>=oF?on:u>=tV?kZ:on)

+
hpR(x?rR:rL,kl,tw)/tw*(T/tVII/tXII%on)*(u>=rii?z:u>=N?on:z)

+
tanh((
lp(
tanh(

(
(atan(drII**(T%tXV)*((x?cos:sin)(fr*cbrt(T%tXV))*fr+(x?rR:rL)/si))/hniii)*(u>=dvii?z:u>=dv?on:u>=div?z:u>=civ?on:u>=bi?z:u>=uvi?on:u>=uiii?z:u>=ui?on:u>=uii?z:u>=ni?on:u>=oF?z:u>=tVI?on:u>=riv?z:u>=tV?on:z)

+

tanh(tanh(onaqr*drIII**(T*tw%tXVI)*atan((x?cos:sin)(((tw*(on-tXVIII/(tV+T*tw%tXVI))+t/hnk)/tVIII%on)*tw*PI)/onaqr)*((T*tw>>sx)&on))*oah+lp(bp(((T*tw%tXVI)/tXI+fr)**tw*(hni+(((-T*tw>>sx)&on)/tV))**-((T*tw%tXVI)/tXI-on)/svn*(x?rR:rL)/((((-T*tw>>sx)&on)*tw)+on)*tri,vnii,vnii),vni)/hnii)*onaqr*(u>=dvii?z:u>=dv?on:u>=div?z:u>=rIVv?on:u>=uiii?z:u>=ui?on:u>=uii?z:u>=nii?on:u>=oF?z:u>=tVI?on:u>=riv?z:u>=tV?on:z)

+

(hpR(drI**(T*tw%tXIV)*(x?rR:rL),klv,tw)*(T/tVII/tVII%tw)/tri)*(u>=dvii?z:u>=dv?on:u>=div?z:u>=civ?on:u>=uiii?z:u>=ui?on:u>=uii?z:u>=nii?on:u>=oF?z:u>=tVI?on:u>=riv?z:u>=tV?on:z)
)
/onaqr

)
,vnv)*PI/tw

)*onaqr)*onaqr
+
(hpR(rR*(-T/tVII/tVII%on+on)*(-T/tVII/tVI%on+on),qurt,tw)*(u>=dvii?z:u>=uiii?z:u>=quI?on:u>=oF?z:u>=tVI?on:u>=riv?z:u>=tV?on:z))*(u>=ui?vni:u>=uii?z:u>=nii?vni:u>=quI?vniv:vni)
+
lpR((x?rR:rL),vni,tw)*abs(T/tX/tVII%tw-on)*(u>=dix?z:u>=dviii?tw:u>=dvi?z:u>=diii?tw:u>=dii?z:u>=di?tw:u>=biii?z:u>=bii?tw:u>=uv?z:u>=uiv?tw:u>=niv?z:u>=niii?tw:u>=qIV?z:u>=qIII?tw:u>=qII?z:u>=qI?on:u>=rvii?z:u>=rvi?tw:u>=riii?z:u>=ri?on:z)
)
/
hniv
+
lp((x?rR:rL),kl)/tw
,
[Mix(z),Mix(on)]