t||(wsin=(phase)=>(-cos(phase/256*PI)+1)*128-.5,fx=[],dMax=1e6,lpf=lowPassFilter=(a,c)=>(lp_fxii=fxi++,fx[lp_fxii]??=0,fx[lp_fxii]+=(a-fx[lp_fxii])*c),hpf=highPassFilter=(a,c)=>a-lpf(a,c),bpf=bandPassFilter=(a,hc,lc)=>hpf(lpf(a,lc),hc),nf=notchFilter=(a,hc,lc)=>(hpf(a,hc)+lpf(a,lc))/1.75,dly=multiTabDelay=(audio,heads,dw,fbfn=x=>x)=>{dly_fxii=fxi++;fx[dly_fxii]??=Array(dMax).fill(0);dly_wi	=dt%dMax;dly_feed=audio;dly_out=0;for(let head of heads){dly_ri=(dMax+dt-round(head.t))%dMax;dly_feed+=fx[dly_fxii][dly_ri]*head.fb;dly_out+=fx[dly_fxii][dly_ri]*head.m;}fx[dly_fxii][dly_wi]=fbfn(dly_feed);return audio*(1-dw)+dly_out*dw;}),fxi=0,dt=t,rvrbHeads=[[{t:1e4+wsin(t/180), m:.6, fb:.3},{t:16e3+wsin(t/300), m:.5, fb:.5},{t:21e3+wsin(t/380), m:.3, fb:.7},{t:28e3+wsin(t/420), m:.2, fb:.9}],[{t:98e2+wsin(t/200), m:.6, fb:.3},{t:15e3+wsin(t/320), m:.5, fb:.5},{t:22e3+wsin(t/320), m:.3, fb:.7},{t:27e3+wsin(t/450), m:.2, fb:.9}]],

Q=j=>lpf((
bpm=90,sr=44100,r=abs(t/sr/180*3*32768*bpm)/2,
nn=(t/sr*256)*480*2**(-5/12),
vi=64+(sin(r/2048)+sin(r/3072))*1.25+sin(r/4096)*0.5,

rng=random()-.5,b=r/8192,B=b/8,T=n=>(e=a=>tanh(2*sin((aa=nn*j*a*(1<<(s=n+4)/7)*2**(((2*s%14-(s%7>3))-3)/12))*PI/1280+vi+sin(aa*PI/1280+vi)))*16+lpf((((aa/j+vi/2)/10)%256-128)/20,.25),e(1)+e(2*j)/4)/1.16,R=17-(B|0)%4,f=n=>T((b/2^(Y=B/3*8+3))%12+7+n),c=(T(R)+T(R+2)+T(R+4)+T(R+6))/3,u=f(14)/2,P=(T(R-7)+T(R-3))/2*(1+b%2|0),C=c+1.5*T(R-14),k=b%64<60,a=T((b^Y)%6+21)/2,([m=f(7),m+B/8%1*k*C,M=m+C,m+k*C,F=M+u+f(0)/2+P,X=F+u/2,k*C,i=u+P,m+k*(i+c),F,X,F+a,X+a*2,m+u/2+a+c,u+a+c,a+k*T(R)][B>>3]||0)/128+(lpf(rng,.0025)*4+lpf(bpf(sin((t*1.5>>4)**7*j)*(sin((t*1.5>>3)**7*j)*200|0?0:rng*4),0,.1),.125)*1.5+bpf(rng,.3,.1)/6)*(r>>22>1?0:1)*(reg={o:1,g:g=(b%64<60?1:(r>>13&1?(r/32768%1)**10:(1-r/32768%1)**5)),h:g/2,v:.5,w:b},(reg[x='ogogoohvgoooooow'[B>>3]]||0))
)*max(.01,min(1,(r/2**20)**.75)),max(0,min(1,(r/2**20)**2)),pan=0.5*sin(t/5e4)+0.5*sin(t/9e4+2)),
[dly(atan(Q(1.005))*3,rvrbHeads[0],.625,x=>tanh(bpf(x,.01,.5)/180)*80)*((pan/3)+.667),dly(atan(Q(0.995))*3,rvrbHeads[1],.625,x=>tanh(bpf(x,.01,.5)/180)*80)*((-pan/3)+.667)]